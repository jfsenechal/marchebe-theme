<div data-show-banner="{{ cookieHasSetPreferences() }}"
     data-essential="{{  cookieIsAuthorizedByName('essential') }}"
     data-statistics="{{  cookieIsAuthorizedByName('statistics') }}"
     data-encapsulated="{{  cookieIsAuthorizedByName('encapsulated') }}"
     x-data="{
    isPopupCookieOpen: false,
    showBanner: this.$el.dataset.essential,
    essential: false,
    statistics: false,
    encapsulated: false,
    init() {
        this.showBanner = true
    },
    togglePopupCookie() {
        this.isPopupCookieOpen = !this.isPopupCookieOpen;
    },
    async acceptAll() {
        this.essential = this.$el.dataset.essential
        this.statistics = this.$el.dataset.statistics
        this.encapsulated = this.$el.dataset.encapsulated
        await this.savePreferences()
    },
    async savePreferences() {
        const formData = new FormData()
        formData.append('action', 'set_cookie_action')
        formData.append('nonce', wpData.nonce)
        formData.append('essential', this.essential)
        formData.append('encapsulated', this.encapsulated)
        formData.append('statistics', this.statistics)

        try {
            const response = await fetch(wpData.ajaxUrl, {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (result.success && result.data) {
                console.log(result.data);

            } else {
                console.error('Error fetching posts:', result.data?.message || 'Unknown error');

            }
        } catch (error) {
            console.error('Error:', error);

        } finally {

        }
    }
}">

    <section x-show="showBanner"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-y-4"
             x-transition:enter-end="opacity-100 translate-y-0"
             class="isolate z-30 fixed max-w-md p-5 mx-auto bg-white border border-gray-200 shadow-2xl left-4 md:left-12 bottom-4 md:bottom-16 rounded-2xl">
        <div class="flex items-start gap-3">
            <span class="text-3xl flex-shrink-0">üç™</span>
            <div class="flex-1">
                <h4 class="font-bold text-gray-900 text-lg">Cookie Notice</h4>
                <p class="mt-2 text-gray-700 leading-relaxed">
                    Ce site utilise des cookies pour vous fournir une exp√©rience optimale.
                    <a href="/administration/rgpd" class="text-citoyen hover:underline">
                        Mentions l√©gales et RGPD
                    </a>
                </p>
                <div class="flex flex-row sm:flex-row items-stretch sm:items-center gap-2 mt-4">
                    <button @click="togglePopupCookie"
                            type="button"
                            class="cursor-pointer font-medium text-gray-700 hover:text-gray-900 underline transition-colors focus:outline-none">
                        Personnaliser
                    </button>
                    <button @click="acceptAll"
                            type="button"
                            class="cursor-pointer bg-citoyen font-semibold rounded-lg hover:bg-opacity-90 text-white px-5 py-2.5 transition-all focus:outline-none focus:ring-2 focus:ring-citoyen focus:ring-offset-2 shadow-md">
                        Tout accepter
                    </button>
                </div>
            </div>
        </div>
    </section>
    {% include '@AcMarche/widgets/_cookies_popup.html.twig' %}
</div>