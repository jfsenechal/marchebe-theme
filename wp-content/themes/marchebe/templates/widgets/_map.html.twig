{% if latitude and longitude %}
    {% if encapsulatedAllowed %}
        <div id="openmap" class="mt-3" style="width: 100%; height: 400px;"></div>

        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() {
                if (typeof L !== 'undefined') {
                    const latitude = parseFloat('{{ latitude }}');
                    const longitude = parseFloat('{{ longitude }}');
                    const center = [latitude, longitude];
                    const nom = "{{ title|raw }}";

                    const map = L.map('openmap').setView(center, 15);

                    L.tileLayer('https://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                        minZoom: 1,
                        maxZoom: 20
                    }).addTo(map);

                    L.marker(center, {
                        title: nom,
                        draggable: false
                    }).addTo(map)
                      .bindPopup(nom)
                      .openPopup();
                }
            });
        </script>
    {% else %}
        <div class="mt-3" style="width: 100%; height: 400px; background-color: #f3f4f6; border: 1px solid #d1d5db; border-radius: 8px; display: flex; align-items: center; justify-content: center; text-align: center; padding: 20px;">
            <div>
                <p class="text-gray-700 mb-3">Pour afficher la carte, veuillez accepter les cookies de services encapsulés.</p>
                <button onclick="window.scrollTo({top: 0, behavior: 'smooth'});" class="bg-citoyen text-white px-4 py-2 rounded hover:bg-opacity-90">
                    Gérer les préférences
                </button>
            </div>
        </div>
    {% endif %}
{% endif %}
