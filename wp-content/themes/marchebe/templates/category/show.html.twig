<div class="bg-slate-50 mt-16" x-data="
{
  currentSite: {{ currentSite }},
  currentCategory: {{ category.term_id }},
  categorySelected: {{ category.term_id }},
  loading: false,
  categoryName: '{{ category.name }}',
  allPosts: {{ postsSerialized }},
  filteredPosts: {{ postsSerialized }},
  handleCategorySelected(category) {
    this.categorySelected = category.cat_ID;
    this.categoryName = category.name;
  },
  async selectCategory(categoryId, categoryName) {
    this.categorySelected = categoryId;
    this.categoryName = categoryName;
    await this.fetchData();
    await this.$nextTick();
    const element = document.getElementById('posts');
    if (element) {
      element.scrollIntoView({behavior: 'smooth', block: 'start'});
    }
  },
  isSelected(categoryId){
    return this.categorySelected === categoryId;
  },
  async fetchData() {
    this.loading = true;

    const formData = new FormData();
    formData.append('action', 'set_category_action');
    formData.append('nonce', wpData.categoryNonce);
    formData.append('categorySelected', this.categorySelected);
    formData.append('currentSite', this.currentSite);

    try {
        const response = await fetch(wpData.ajaxUrl, {
            method: 'POST',
            body: formData
        });

        const result = await response.json();

        if (result.success && result.data.posts) {
            this.filteredPosts = result.data.posts;
        } else {
            console.error('Error fetching posts:', result.data?.message || 'Unknown error');
            this.filteredPosts = [];
        }
    } catch (error) {
        console.error('Error:', error);
        this.filteredPosts = [];
    } finally {
        this.loading = false;
    }
  }
}">
    <!-- HERO HEADER SECTION -->
    {% include '@AcMarche/article/_header.html.twig' %}
    <!-- MAIN CONTENT SECTION -->
    <main id="main-content" class="relative z-20 -mt-16 md:-mt-24">
        <section class="container mx-auto bg-white rounded-xl shadow-2xl mb-3">
            <div class="p-4 md:p-6 ">
                {% include '@AcMarche/widgets/_breadcrumbs.html.twig' %}
                <div class="text-center">
                    {% include '@AcMarche/article/_title.html.twig' %}
                </div>
            </div>
            {% include '@AcMarche/category/_menu.html.twig' %}
            {% include '@AcMarche/category/_description.html.twig' %}
            {% include '@AcMarche/category/_posts.html.twig' %}
        </section>
    </main>
</div>
{% include '@AcMarche/widgets/_animation_script.html.twig' %}