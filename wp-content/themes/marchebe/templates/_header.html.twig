<!-- Main Header -->
<nav x-data="{
    // State Management
    isMobileMenuOpen: false,
    activeMobileDrawerId: null,
    isDesktopMenuOpen: false,
    activeDesktopCategory: null,
    isSearchModalOpen: false,
    searchQuery: '',
    results: [],
    isLoading: false,
    error: '',
    // Computed
    get activeMobileCategoryData() {
        if (!this.activeMobileDrawerId || !this.menuData) return null;
        return this.menuData.find(item => item.blogid === this.activeMobileDrawerId);
    },
    // Methods
    toggleMobileMenu() {
        this.isMobileMenuOpen = !this.isMobileMenuOpen;
        if (!this.isMobileMenuOpen) {
            setTimeout(() => {
                this.activeMobileDrawerId = null;
            }, 300);
        }
    },

    toggleDesktopMenu() {
        this.isDesktopMenuOpen = !this.isDesktopMenuOpen;
    },

    openMobileDrawer(id) {
        this.activeMobileDrawerId = id;
    },

    closeMobileDrawer() {
        this.activeMobileDrawerId = null;
    },

    selectDesktopCategory(category) {
        this.activeDesktopCategory = category;
    },

    openSearchModal() {
      this.isSearchModalOpen = true;
      },

    closeSearchModal() {
        this.isSearchModalOpen = false;
        this.searchQuery = '';
        this.results = [];
        this.error = '';
    },

    closeOnClickOutside(event) {
        if (!this.isDesktopMenuOpen) return;

        const button = this.$refs.desktopMenuButton;
        const panel = this.$refs.desktopMenuPanel;

        const isClickOnButton = button && button.contains(event.target);
        const isClickInsidePanel = panel && panel.contains(event.target);

        if (!isClickOnButton && !isClickInsidePanel) {
            this.isDesktopMenuOpen = false;
        }
    },
    menuData: {{ menu_data }}
    }">
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-0 focus:left-0 focus:z-50 focus:bg-blue-600 focus:text-white focus:p-4 focus:m-2 focus:rounded">
        Aller au contenu principal
    </a>

    <header class="bg-white shadow-md relative z-40" id="main-header">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <a href="/" class="">
                    <img src="{{ template_directory }}/assets/images/img_logo.png"
                         alt="Ville de Marche-en-Famenne"
                         class="h-10 w-16 xl:h-14 xl:w-24"/>
                </a>

                <!-- Desktop Menu Trigger -->
                <div class="hidden md:flex flex-row items-center justify-center space-x-6">
                    <button
                            x-ref="desktopMenuButtonRef"
                            @click="toggleDesktopMenu()"
                            type="button"
                            class="flex flex-row items-center justify-center gap-2 h-16 cursor-pointer font-semibold text-cta-dark hover:text-cta-light transition-colors border-b-3 border-transparent hover:border-b-3 hover:border-cta-light leading-6 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-gray-800 focus-visible:ring-white"
                            :aria-expanded="isDesktopMenuOpen"
                            aria-controls="desktop-menu"
                    >
                        <i class="fas fa-bars" aria-hidden="true"></i> <span>Vivre Ã  Marche</span>
                    </button>
                    {% include '@AcMarche/navigation/_shortcuts.html.twig' %}
                </div>
                <!-- Mobile Menu Trigger (Hamburger) -->
                {% include '@AcMarche/navigation/_mobile_vivre_button.html.twig' %}
                {% include '@AcMarche/navigation/_social_icons.html.twig' %}
            </div>
        </div>
        <!-- Search modal-->
        {% include '@AcMarche/search/_modal.html.twig' %}
    </header>
    <!-- Desktop Menu Panel -->
    {% include '@AcMarche/navigation/_desktop_menu.html.twig' %}
    {# Mobile Menu Panel #}
    {% include '@AcMarche/navigation/_mobile_menu.html.twig' %}

</nav>